Rewrite the constraint solver to use generators.
